const caminhoJson="./data/unidades.json";var dadosJson="",arrayCoeficientes=[],casasDecimais=3,checkComum=!1,checkSi="",dolar="",euro="",bitcoin="";const idCategoria="selecao-categoria",idTipo="selecao-tipo",idUnidade="selecao-unidade",idUnidade2="selecao-unidade-2",idTextUnidade="text-unidade",idTextUnidade2="text-unidade-2",idRangeDecimais="range-decimais",idTextDecimais="text-decimais",idSelectMoedas="selecao-moeda",idLateral="lateral-d",objSelectCategoria=document.getElementById(idCategoria),objSelectTipo=document.getElementById(idTipo),objSelectUnidade=document.getElementById(idUnidade),objSelectUnidade2=document.getElementById(idUnidade2),objTextUnidade=document.getElementById(idTextUnidade),objTextUnidade2=document.getElementById(idTextUnidade2),objRangeDecimais=document.getElementById(idRangeDecimais),objTextDecimais=document.getElementById(idTextDecimais),objSelectMoeda=document.getElementById(idSelectMoedas),objLateral=document.querySelector(".lateral-d");async function extraiJson(e){return await fetch(e).then((e=>e.json())).then((e=>{try{return e}catch(e){return console.error("Erro ao processar o JSON: "+e),[]}})).catch((e=>alert("Erro ao acessar a base de dados "+e)))}async function funcaoPrincipal(){dadosJson=await extraiJson(caminhoJson)}function verifica(){setTimeout((()=>{""===dadosJson?verifica():extraiCategoria(idCategoria)}),"200")}function extraiCategoria(e){try{let a=dadosJson,t=[];for(let e in a)a[e].categoria&&t.push(a[e].categoria);insereDadosCombobox(removerElementosRepetidos(t),e),extraiTipo(idTipo)}catch(e){return alert("Erro ao acessar a base de dados. "+e),[]}}function removerElementosRepetidos(e){const a={},t=[];for(const i of e)a[i]||(a[i]=!0,t.push(i));return t}function limpaCombobox(e){document.getElementById(e).innerHTML=""}function insereDadosCombobox(e,a){const t=document.getElementById(a);for(let a in e){const i=document.createElement("option");i.text=e[a],t.add(i)}}function extraiTipo(e){try{let a=[],t=dadosJson,i=objSelectCategoria.value;for(let e in t)t[e].categoria===i&&a.push(t[e].tipo);limpaCombobox(e),insereDadosCombobox(removerElementosRepetidos(a),e),extraiUnidade(idUnidade)}catch(e){return alert("Erro ao acessar a base de dados "+e),[]}}function extraiUnidade(e){try{let a=dadosJson,t=[];arrayCoeficientes=[];let i=objSelectTipo.value;if(!1===checkComum)if(""===checkSi)for(let e in a)a[e].tipo===i&&(t.push(a[e].nick),arrayCoeficientes.push(a[e].coeficiente));else for(let e in a)a[e].tipo===i&&a[e].sistema===checkSi&&(t.push(a[e].nick),arrayCoeficientes.push(a[e].coeficiente));else if(""===checkSi)for(let e in a)a[e].tipo===i&&a[e].frequente===checkComum&&(t.push(a[e].nick),arrayCoeficientes.push(a[e].coeficiente));else for(let e in a)a[e].tipo===i&&a[e].sistema===checkSi&&a[e].frequente===checkComum&&(t.push(a[e].nick),arrayCoeficientes.push(a[e].coeficiente));limpaCombobox(e),insereDadosCombobox(removerElementosRepetidos(t),e),limpaCombobox(e+"-2"),insereDadosCombobox(removerElementosRepetidos(t),e+"-2"),calcula()}catch(e){return alert("Erro ao acessar a base de dados. (Extrai unidades)"+e),[]}}function calcula(){if(""===objTextUnidade.value)return objTextUnidade2.value="",void preencheTabela();let e=objSelectUnidade.selectedIndex,a=objSelectUnidade2.selectedIndex;if(-1===e&&(e=0),-1===a&&(a=0),"Temperatura"===objSelectCategoria.value)objTextUnidade2.value=calculaTemperatura(e,a);else if("Base"===objSelectCategoria.value)objTextUnidade2.value=calculaBases(e,a);else if("AWG (awg)"===objSelectUnidade.value||"AWG (awg)"===objSelectUnidade2.value)objTextUnidade2.value=calculaAWG(e,a);else{let t=arrayCoeficientes[e]/arrayCoeficientes[a],i=Math.round(Number(objTextUnidade.value.replace(",","."))*t*10**casasDecimais)/10**casasDecimais;isNaN(i)?objTextUnidade2.value="-":objTextUnidade2.value=String(i).replace(".",",")}ajustaTexto(),preencheTabela()}function calculaTemperatura(e,a){return isNaN(Number(objTextUnidade.value.replace(",",".")))?"-":0===e&&1===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))-273.15)*10**casasDecimais)/10**casasDecimais).replace(".",","):1===e&&0===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))+273.15)*10**casasDecimais)/10**casasDecimais).replace(".",","):0===e&&2===a?String(Math.round((1.8*Number(objTextUnidade.value.replace(",","."))-459.67)*10**casasDecimais)/10**casasDecimais).replace(".",","):2===e&&0===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))+459.67)/1.8*10**casasDecimais)/10**casasDecimais).replace(".",","):1===e&&2===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))/5*9+32)*10**casasDecimais)/10**casasDecimais).replace(".",","):2===e&&1===a?String(Math.round(5*(Number(objTextUnidade.value.replace(",","."))-32)/9*10**casasDecimais)/10**casasDecimais).replace(".",","):e===a?String(objTextUnidade.value.replace(",",".")).replace(".",","):void 0}function calculaBases(e,a){if(0===e)return isNaN(Number(objTextUnidade.value.replace(",",".")))?"-":0===a?(Math.round(Number(objTextUnidade.value.replace(",","."))*10**casasDecimais)/10**casasDecimais).toString():1===a?(Math.round(Number(objTextUnidade.value.replace(",","."))*10**casasDecimais)/10**casasDecimais).toString(16):2===a?binaryTransform(Number(objTextUnidade.value.replace(",","."))):romanize(objTextUnidade.value.replace(",","."));if(1===e){if(isNaN(parseInt(objTextUnidade.value.replace(",","."),16)))return"-";if(0===a)return parseInt(objTextUnidade.value.replace(",","."),16);if(1===a)return objTextUnidade.value;if(2===a){return binaryTransform(parseInt(objTextUnidade.value.replace(",","."),16))}return romanize(parseInt(objTextUnidade.value.replace(",","."),16))}if(2===e){if(isNaN(parseInt(objTextUnidade.value.replace(",","."),2)))return"-";if(0===a)return parseInt(objTextUnidade.value.replace(",","."),2);if(1===a){let e=parseInt(objTextUnidade.value.replace(",","."),2);return(Math.round(Number(e)*10**casasDecimais)/10**casasDecimais).toString(16)}if(2===a)return objTextUnidade.value;return romanize(parseInt(objTextUnidade.value.replace(",","."),2))}if(!1===deromanize(objTextUnidade.value))return"-";if(0===a)return deromanize(objTextUnidade.value.replace(",","."));if(1===a){let e=deromanize(objTextUnidade.value.replace(",","."));return(Math.round(Number(e)*10**casasDecimais)/10**casasDecimais).toString(16)}if(2===a){let e=deromanize(objTextUnidade.value.replace(",","."));return String(binaryTransform(e))}return objTextUnidade.value}function calculaAWG(e,a){if(isNaN(Number(objTextUnidade.value.replace(",","."))))return"-";{let t=arrayCoeficientes[e],i=t/arrayCoeficientes[a];if("AWG (awg)"===objSelectUnidade.value&&"AWG (awg)"!==objSelectUnidade2.value){let e=Number(objTextUnidade.value.replace(",",".")),a=0;0===e&&(a=objTextUnidade.value.length,e=-1*(a-1));let t=.127*Math.pow(92,(36-e)/39),o=Math.round(t*i*10**casasDecimais)/10**casasDecimais;return isNaN(o)?"-":String(o).replace(".",",")}if("AWG (awg)"!==objSelectUnidade.value&&"AWG (awg)"===objSelectUnidade2.value){let e=Number(objTextUnidade.value.replace(",","."))*(t/.001),a=Math.round(-1*(Math.log10(e/.127)/Math.log10(92)*39-36)*10**casasDecimais)/10**casasDecimais;return isNaN(a)?"-":String(a).replace(".",",")}return objTextUnidade.value}}function binaryTransform(e){let a=e,t="";for(;a>0;)t=1&a?"1"+t:"0"+t,a>>=1;return""===t&&(t="-"),t}function decimais(){objTextDecimais.innerHTML=objRangeDecimais.value+" casas decimais",casasDecimais=Number(objRangeDecimais.value),calcula()}function unidadesComuns(){!0===checkComum?(checkComum=!1,extraiUnidade(idUnidade)):(checkComum=!0,extraiUnidade(idUnidade))}function sistemaSi(){""===checkSi?(checkSi="SI",extraiUnidade(idUnidade)):(checkSi="",extraiUnidade(idUnidade))}function trocaUnidades(){let e=objSelectUnidade.selectedIndex;objSelectUnidade.selectedIndex=objSelectUnidade2.selectedIndex,objSelectUnidade2.selectedIndex=e,calcula()}function ajustaTexto(){objTextUnidade.value.length>8&&objTextUnidade.value.length<=11?objTextUnidade.style.fontSize="1.5rem":objTextUnidade.value.length>11?objTextUnidade.style.fontSize="1rem":objTextUnidade.style.fontSize="2rem",objTextUnidade2.value.length>8&&objTextUnidade2.value.length<=11?objTextUnidade2.style.fontSize="1.5rem":objTextUnidade2.value.length>11?objTextUnidade2.style.fontSize="1rem":objTextUnidade2.style.fontSize="2rem"}function getCotacoes(){fetch("https://economia.awesomeapi.com.br/last/USD-BRL,EUR-BRL,BTC-BRL").then((e=>e.json())).then((e=>{dolar=e.USDBRL.bid||"Não disponível",euro=e.EURBRL.bid||"Não disponível",bitcoin=e.BTCBRL.bid||"Não disponível",Number(dolar)&&(dolar=Number(dolar).toFixed(2)),Number(euro)&&(euro=Number(euro).toFixed(2)),Number(bitcoin)&&(bitcoin=Number(bitcoin).toFixed(2)),printCotacoes()})).catch((e=>console.error(e)))}function printCotacoes(){"Real"===objSelectMoeda.value?(document.getElementById("cotacoes-real").textContent="R$ 1,00",document.getElementById("cotacoes-dolar").textContent=`R$ ${dolar}`.replace(".",","),document.getElementById("cotacoes-euro").textContent=`R$ ${euro}`.replace(".",","),document.getElementById("cotacoes-bitcoin").textContent=`R$ ${bitcoin}`.replace(".",",")):"Dolar"===objSelectMoeda.value?(document.getElementById("cotacoes-real").textContent=`$ ${(1/dolar).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-dolar").textContent=`$ ${(dolar/dolar).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-euro").textContent=`$ ${(euro/dolar).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-bitcoin").textContent=`$ ${(bitcoin/dolar).toFixed(2)}`.replace(".",",")):"Euro"===objSelectMoeda.value?(document.getElementById("cotacoes-real").textContent=`€ ${(1/euro).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-dolar").textContent=`€ ${(dolar/euro).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-euro").textContent=`€ ${(euro/euro).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-bitcoin").textContent=`€ ${(bitcoin/euro).toFixed(2)}`.replace(".",",")):(document.getElementById("cotacoes-real").textContent=`₿ ${(1/bitcoin).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-dolar").textContent=`₿ ${(dolar/bitcoin).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-euro").textContent=`₿ ${(euro/bitcoin).toFixed(2)}`.replace(".",","),document.getElementById("cotacoes-bitcoin").textContent=`₿ ${(bitcoin/bitcoin).toFixed(2)}`.replace(".",","))}function abreLateral(){"block"===objLateral.style.display?objLateral.style.display="none":(objLateral.style.display="block",preencheTabela())}function preencheTabela(){if(""===objTextUnidade.value){document.querySelector("#textareaTabela").value="Insira um valor para conversão!",objTextUnidade.focus()}else{let a=document.querySelector("#textareaTabela"),t=objTextUnidade.value+" "+objSelectUnidade.value+" equivale a:\n\n";for(var e=0;e<objSelectUnidade2.options.length;e++)t=t+calculai(e)+" "+objSelectUnidade2.options[e].value+"\n";let i=document.querySelector(".lateral-d");a.value=t,i.appendChild(a),ajustaTexto()}}function calculai(e){if(""===objTextUnidade.value)return void(objTextUnidade2.value="");let a=objSelectUnidade.selectedIndex,t=e;if(-1===a&&(a=0),-1===t&&(t=0),"Temperatura"===objSelectCategoria.value)return calculaTemperatura(a,t);if("Base"===objSelectCategoria.value)return calculaBases(a,t);if("AWG (awg)"===objSelectUnidade.value)return 13!==t?calculaAWGi(a,t):objTextUnidade.value;{if(13===t)return calculaAWGi(a,t);let e=arrayCoeficientes[a]/arrayCoeficientes[t],i=Math.round(Number(objTextUnidade.value.replace(",","."))*e*10**casasDecimais)/10**casasDecimais;return isNaN(i)?"-":String(i).replace(".",",")}}function calculaTemperaturai(e,a){return 0===e&&1===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))-273.15)*10**casasDecimais)/10**casasDecimais).replace(".",","):1===e&&0===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))+273.15)*10**casasDecimais)/10**casasDecimais).replace(".",","):0===e&&2===a?String(Math.round((1.8*Number(objTextUnidade.value.replace(",","."))-459.67)*10**casasDecimais)/10**casasDecimais).replace(".",","):2===e&&0===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))+459.67)/1.8*10**casasDecimais)/10**casasDecimais).replace(".",","):1===e&&2===a?String(Math.round((Number(objTextUnidade.value.replace(",","."))/5*9+32)*10**casasDecimais)/10**casasDecimais).replace(".",","):2===e&&1===a?String(Math.round(5*(Number(objTextUnidade.value.replace(",","."))-32)/9*10**casasDecimais)/10**casasDecimais).replace(".",","):e===a?String(objTextUnidade.value.replace(",",".")).replace(".",","):void 0}function romanize(e){if(!+e)return!1;for(var a=String(+e).split(""),t=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"],i="",o=3;o--;)i=(t[+a.pop()+10*o]||"")+i;return Array(+a.join("")+1).join("M")+i}function deromanize(e){var a,t=/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,i={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},o=0;if(!(e=e.toUpperCase())||!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(e))return!1;for(;a=t.exec(e);)o+=i[a[0]];return o}function calculaAWGi(e,a){if(isNaN(Number(objTextUnidade.value.replace(",","."))))return"-";{let t=arrayCoeficientes[e],i=t/arrayCoeficientes[a];if("AWG (awg)"===objSelectUnidade.value){let e=Number(objTextUnidade.value.replace(",",".")),a=0;0===e&&(a=objTextUnidade.value.length,e=-1*(a-1));let t=.127*Math.pow(92,(36-e)/39),o=Math.round(t*i*10**casasDecimais)/10**casasDecimais;return isNaN(o)?"-":String(o).replace(".",",")}if(13===a){let e=Number(objTextUnidade.value.replace(",","."))*(t/.001),a=Math.round(-1*(Math.log10(e/.127)/Math.log10(92)*39-36)*10**casasDecimais)/10**casasDecimais;return isNaN(a)?"-":String(a).replace(".",",")}}}objTextUnidade.addEventListener("input",(()=>{calcula()})),funcaoPrincipal(),verifica(),decimais(),getCotacoes();